(function(h){var e={init:function(b){var a=this;if(a.data("jqv")===undefined){e._saveOptions(a,b);h(".formError").live("click",function(){h(this).fadeOut(150,function(){h(this).remove()})})}},attach:function(){var b=this,a=b.data("jqv");if(!a.binded){b.find("[class*=validate]").not("[type=checkbox]").bind(a.validationEventTrigger,e._onFieldEvent);b.find("[class*=validate][type=checkbox]").bind("click",e._onFieldEvent);b.bind("submit",e._onSubmitEvent);a.binded=true}},detach:function(){var b=this,
a=b.data("jqv");if(a.binded){b.find("[class*=validate]").not("[type=checkbox]").unbind(a.validationEventTrigger,e._onFieldEvent);b.find("[class*=validate][type=checkbox]").unbind("click",e._onFieldEvent);b.unbind("submit",e.onAjaxFormComplete);b.removeData("jqv")}},validate:function(){return e._validateFields(this)},validateform:function(){return e._onSubmitEvent(this)},showPrompt:function(b,a,d,c){var f=this.closest("form").data("jqv");if(!d)f.promptPosition=d;f.showArrow=c===true;e._showPrompt(this,
b,a,false,f)},hide:function(){this.find(".formError").fadeTo("fast",0.3,function(){h(this).remove()})},hideAll:function(){h(".formError").fadeTo("fast",0.3,function(){h(this).remove()})},_onFieldEvent:function(){var b=h(this),a=b.closest("form").data("jqv");e._validateField(b,a)},_onSubmitEvent:function(){var b=h(this),a=e._validateFields(b,true),d=b.data("jqv");if(a&&d.ajaxFormValidation){e._validateFormWithAjax(b,d);return false}if(d.onValidationComplete){d.onValidationComplete(b,a);return false}return a},
_checkAjaxStatus:function(b){var a=true;h.each(b.ajaxValidCache,function(d,c){if(c===false)return a=false});return a},_validateFields:function(b,a){var d=b.data("jqv"),c=false;b.find("[class*=validate]").each(function(){var i=h(this);i.hasClass("ajaxed")||(c|=e._validateField(i,d,a))});c|=!e._checkAjaxStatus(d);if(c){if(d.scroll){var f=Number.MAX_VALUE;b=b.find(".formError:not('.greenPopup')");for(var g=0;g<b.length;g++){var j=h(b[g]).offset().top;if(j<f)f=j}if(d.isOverflown){g=h(d.overflownDIV);
b=g.scrollTop();g=-parseInt(g.offset().top);f+=b+g-5;h(d.overflownDIV+":not(:animated)").animate({scrollTop:f},1100)}else h("html:not(:animated),body:not(:animated)").animate({scrollTop:f},1100)}return false}return true},_validateFormWithAjax:function(b,a){var d=b.serialize();h.ajax({type:"GET",url:b.attr("action"),cache:false,dataType:"json",data:d,form:b,methods:e,options:a,beforeSend:function(){return a.onBeforeAjaxFormValidation(b,a)},error:function(c,f){e._ajaxError(c,f)},success:function(c){if(c!==
true){for(var f=false,g=0;g<c.length;g++){var j=c[g],i=h(h("#"+j[0])[0]);if(i.length==1){var k=j[2];if(j[1]===true)if(k=="")e._closePrompt(i);else{if(a.allrules[k])if(j=a.allrules[k].alertTextOk)k=j;e._showPrompt(i,k,"pass",false,a)}else{f|=true;if(a.allrules[k])if(j=a.allrules[k].alertText)k=j;e._showPrompt(i,k,"",false,a)}}}a.onAjaxFormComplete(!f,b,c,a)}else a.onAjaxFormComplete(true,b,"",a)}})},_validateField:function(b,a,d){b.attr("id")||h.error("jQueryValidate: an ID attribute is required for this field: "+
b.attr("name")+" class:"+b.attr("class"));var c=/\[(.*)\]/.exec(b.attr("class"));if(c===null)return false;var f=c[1].split(/\[|,|\]/);c=false;var g=b.attr("name"),j="";a.isError=false;a.showArrow=true;for(var i=0;i<f.length;i++){var k=undefined;switch(f[i]){case "optional":if(!b.val()){e._closePrompt(b);return a.isError}break;case "required":k=e._required(b,f,i,a);break;case "custom":k=e._customRegex(b,f,i,a);break;case "ajax":if(!d){e._ajax(b,f,i,a);c=true}break;case "minSize":k=e._minSize(b,f,i,
a);break;case "maxSize":k=e._maxSize(b,f,i,a);break;case "min":k=e._min(b,f,i,a);break;case "max":k=e._max(b,f,i,a);break;case "past":k=e._past(b,f,i,a);break;case "future":k=e._future(b,f,i,a);break;case "maxCheckbox":k=e._maxCheckbox(b,f,i,a);b=h(h("input[name='"+g+"']"));break;case "minCheckbox":k=e._minCheckbox(b,f,i,a);b=h(h("input[name='"+g+"']"));break;case "equals":k=e._equals(b,f,i,a);break;case "funcCall":k=e._funcCall(b,f,i,a);break;default:}if(k!==undefined){j+=k+"<br/>";a.isError=true}}d=
b.attr("type");if((d=="radio"||d=="checkbox")&&h("input[name='"+g+"']").size()>1){b=h(h("input[name='"+g+"'][type!=hidden]:first"));a.showArrow=false}c||(a.isError?e._showPrompt(b,j,"",false,a):e._closePrompt(b));return a.isError},_required:function(b,a,d,c){switch(b.attr("type")){case "text":case "password":case "textarea":if(!b.val())return c.allrules[a[d]].alertText;break;case "radio":case "checkbox":b=b.attr("name");if(h("input[name='"+b+"']:checked").size()===0)return h("input[name='"+b+"']").size()===
1?c.allrules[a[d]].alertTextCheckboxe:c.allrules[a[d]].alertTextCheckboxMultiple;break;case "select-one":if(!b.val())return c.allrules[a[d]].alertText;break;case "select-multiple":if(!b.find("option:selected").val())return c.allrules[a[d]].alertText;break}},_customRegex:function(b,a,d,c){a=a[d+1];if(!(new RegExp(c.allrules[a].regex)).test(b.attr("value")))return c.allrules[a].alertText},_funcCall:function(b,a,d,c){var f=window[a[d+1]];if(typeof f==="function")return f(b,a,d,c)},_equals:function(b,
a,d,c){a=a[d+1];if(b.attr("value")!=h("#"+a).attr("value"))return c.allrules.equals.alertText},_maxSize:function(b,a,d,c){a=a[d+1];if(b.attr("value").length>a){b=c.allrules.maxSize;return b.alertText+a+b.alertText2}},_minSize:function(b,a,d,c){a=a[d+1];if(b.attr("value").length<a){b=c.allrules.minSize;return b.alertText+a+b.alertText2}},_min:function(b,a,d,c){a=parseFloat(a[d+1]);if(parseFloat(b.attr("value"))<a)return c.allrules.min.alertText+a},_max:function(b,a,d,c){a=parseFloat(a[d+1]);if(parseFloat(b.attr("value"))>
a)return c.allrules.max.alertText+a},_past:function(b,a,d,c){a=a[d+1];a=a.toLowerCase()=="now"?new Date:e._parseDate(a);if(e._parseDate(b.attr("value"))>a)return c.allrules.past.alertText+e._dateToString(a)},_future:function(b,a,d,c){a=a[d+1];a=a.toLowerCase()=="now"?new Date:e._parseDate(a);if(e._parseDate(b.attr("value"))<a)return c.allrules.future.alertText+e._dateToString(a)},_maxCheckbox:function(b,a,d,c){a=a[d+1];b=b.attr("name");if(h("input[name='"+b+"']:checked").size()>a){c.showArrow=false;
return c.allrules.maxCheckbox.alertText}},_minCheckbox:function(b,a,d,c){a=a[d+1];b=b.attr("name");if(h("input[name='"+b+"']:checked").size()<a){c.showArrow=false;return c.allrules.minCheckbox.alertText+" "+a+" "+c.allrules.minCheckbox.alertText2}},_ajax:function(b,a,d,c){var f=c.allrules[a[d+1]];(a=f.extraData)||(a="");c.isError||h.ajax({type:"GET",url:f.url,cache:false,dataType:"json",data:"fieldId="+b.attr("id")+"&fieldValue="+b.attr("value")+"&extraData="+a,field:b,rule:f,methods:e,options:c,
beforeSend:function(){var g=f.alertTextLoad;g&&e._showPrompt(b,g,"load",true,c)},error:function(g,j){e._ajaxError(g,j)},success:function(g){var j=g[0],i=h(h("#"+j)[0]);if(i.length==1)if(g[1]===false){c.ajaxValidCache[j]=false;c.isError=true;e._showPrompt(i,f.alertText,"",true,c)}else{if(c.ajaxValidCache[j]!==undefined)c.ajaxValidCache[j]=true;(g=f.alertTextOk)?e._showPrompt(i,g,"pass",true,c):e._closePrompt(i)}}})},_ajaxError:function(b,a){if(b.status===0&&a===null)alert("The page is not served from a server! ajax call failed");
else console&&console.log("Ajax error: "+b.status+" "+a)},_dateToString:function(b){return b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()},_parseDate:function(b){var a=b.split("-");if(a!==b)a=b.split("/");return new Date(a[0],a[1]-1,a[2])},_showPrompt:function(b,a,d,c,f){var g=e._getPrompt(b);g?e._updatePrompt(b,g,a,d,c,f):e._buildPrompt(b,a,d,c,f)},_buildPrompt:function(b,a,d,c,f){var g=h("<div>");g.addClass(b.attr("id")+"formError");g.addClass("formError");switch(d){case "pass":g.addClass("greenPopup");
break;case "load":g.addClass("blackPopup")}c&&g.addClass("ajaxed");h("<div>").addClass("formErrorContent").html(a).appendTo(g);if(f.showArrow){a=h("<div>").addClass("formErrorArrow");g.append(a);switch(f.promptPosition){case "bottomLeft":case "bottomRight":a.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --\></div><div class="line2"><!-- --\></div><div class="line3"><!-- --\></div><div class="line4"><!-- --\></div><div class="line5"><!-- --\></div><div class="line6"><!-- --\></div><div class="line7"><!-- --\></div><div class="line8"><!-- --\></div><div class="line9"><!-- --\></div><div class="line10"><!-- --\></div>');
break;case "topLeft":case "topRight":a.html('<div class="line10"><!-- --\></div><div class="line9"><!-- --\></div><div class="line8"><!-- --\></div><div class="line7"><!-- --\></div><div class="line6"><!-- --\></div><div class="line5"><!-- --\></div><div class="line4"><!-- --\></div><div class="line3"><!-- --\></div><div class="line2"><!-- --\></div><div class="line1"><!-- --\></div>');break}}b.before(g);b=e._calculatePosition(b,g,f);g.css({top:b.callerTopPosition,left:b.callerleftPosition,marginTop:b.marginTopSize,
opacity:0});return g.animate({opacity:0.87})},_updatePrompt:function(b,a,d,c,f,g){if(a){c=="pass"?a.addClass("greenPopup"):a.removeClass("greenPopup");c=="load"?a.addClass("blackPopup"):a.removeClass("blackPopup");f?a.addClass("ajaxed"):a.removeClass("ajaxed");a.find(".formErrorContent").html(d);b=e._calculatePosition(b,a,g);a.animate({top:b.callerTopPosition,marginTop:b.marginTopSize})}},_closePrompt:function(b){var a=e._getPrompt(b);a&&a.fadeTo("fast",0,function(){a.remove()})},_getPrompt:function(b){b=
"."+b.attr("id")+"formError";if(b=h(b)[0])return h(b)},_calculatePosition:function(b,a,d){var c,f,g=b.width(),j=a.height(),i=d.isOverflown;if(i){a=c=0;f=-j}else{c=b.offset();a=c.top;c=c.left;f=0}switch(d.promptPosition){default:case "topRight":if(i)c+=g-30;else{c+=g-30;a+=-j}break;case "topLeft":a+=-j-10;break;case "centerRight":c+=g+13;break;case "bottomLeft":a=a+b.height()+15;break;case "bottomRight":c+=g-30;a+=b.height()+5}return{callerTopPosition:a+"px",callerleftPosition:c+"px",marginTopSize:f+
"px"}},_saveOptions:function(b,a){if(h.validationEngineLanguage)var d=h.validationEngineLanguage.allRules;else h.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");a=h.extend({validationEventTrigger:"blur",scroll:true,promptPosition:"topRight",ajaxFormValidation:false,onAjaxFormComplete:h.noop,onBeforeAjaxFormValidation:h.noop,onValidationComplete:false,isOverflown:false,overflownDIV:"",allrules:d,binded:false,showArrow:true,isError:false,ajaxValidCache:{}},
a);b.data("jqv",a);return a}};h.fn.validationEngine=function(b){var a=h(this);if(typeof b==="string"&&b.charAt(0)!="_"&&e[b]){e.init.apply(a);return e[b].apply(a,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){e.init.apply(a,arguments);return e.attach.apply(a)}else h.error("Method "+b+" does not exist in jQuery.validationEngine")}})(jQuery);